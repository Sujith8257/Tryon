<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Stitch Design</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>
<style type="text/tailwindcss">
        :root {
            --background-color: #000000;
            --primary-color: #06f81a;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --card-background: #1E1E1E;
        }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
        }
        .scanner-beam {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color);
            animation: scan 2s infinite linear;
        }
        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 4px solid var(--primary-color);
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-[var(--background-color)] text-[var(--text-primary)]">
<div class="relative flex size-full min-h-screen flex-col justify-between group/design-root overflow-hidden">
<header class="absolute top-0 left-0 right-0 z-20 flex items-center justify-between p-4 bg-black bg-opacity-50">
<a class="text-white" href="home.html">
<svg class="lucide lucide-x" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M18 6 6 18"></path>
<path d="m6 6 12 12"></path>
</svg>
</a>
<h1 class="text-lg font-bold">Scan QR Code</h1>
<div class="w-6"></div>
</header>
<main class="flex-grow flex flex-col items-center justify-center">
<div class="relative w-64 h-64 border-4 border-dashed border-[var(--primary-color)] rounded-lg overflow-hidden" id="scanner-container">
    <video id="video" autoplay muted playsinline></video>
    <div class="camera-overlay">
        <div class="scanner-beam"></div>
    </div>
</div>
<p class="mt-4 text-center text-[var(--text-secondary)]" id="status-text">Starting camera...</p>
</main>
<footer class="bg-[var(--card-background)] rounded-t-2xl p-4 z-10">
<button class="w-full flex items-center justify-center gap-3 py-3 px-4 rounded-lg bg-[var(--background-color)] border border-gray-700" id="gallery-btn">
<svg class="text-[var(--primary-color)]" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<rect height="18" rx="2" ry="2" width="18" x="3" y="3"></rect>
<circle cx="9" cy="9" r="2"></circle>
<path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
</svg>
<span class="font-medium">Access from Gallery</span>
</button>
</footer>
</div>

<script>
let video = document.getElementById('video');
let statusText = document.getElementById('status-text');
let canvas = document.createElement('canvas');
let ctx = canvas.getContext('2d');
let scanning = false;

// Start camera when page loads
document.addEventListener('DOMContentLoaded', function() {
    startCamera();
});

async function startCamera() {
    try {
        statusText.textContent = 'Requesting camera access...';
        
        const stream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: 'environment', // Use back camera on mobile
                width: { ideal: 1280 },
                height: { ideal: 720 }
            }
        });
        
        video.srcObject = stream;
        video.play();
        
        statusText.textContent = 'Camera active. Point at QR code.';
        
        // Start scanning after video is loaded
        video.addEventListener('loadedmetadata', function() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            startScanning();
        });
        
    } catch (error) {
        console.error('Camera access error:', error);
        statusText.textContent = 'Camera access denied. Please allow camera permissions.';
        
        // Show fallback message
        setTimeout(() => {
            statusText.textContent = 'Place the QR code inside the frame to scan.';
        }, 3000);
    }
}

function startScanning() {
    if (scanning) return;
    scanning = true;
    
    function scan() {
        if (!scanning) return;
        
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            const code = jsQR(imageData.data, imageData.width, imageData.height, {
                inversionAttempts: "dontInvert",
            });
            
            if (code) {
                // QR code found!
                statusText.textContent = 'QR Code detected!';
                console.log('QR Code data:', code.data);
                
                // Stop scanning
                scanning = false;
                
                // Handle the QR code data (you can redirect or process it)
                handleQRCode(code.data);
                
                return;
            }
        }
        
        // Continue scanning
        requestAnimationFrame(scan);
    }
    
    scan();
}

function handleQRCode(data) {
    // You can customize this function to handle different types of QR codes
    // For example, if it's a URL, you can redirect to it
    if (data.startsWith('http://') || data.startsWith('https://')) {
        window.open(data, '_blank');
    } else {
        // Show the data in an alert or process it as needed
        alert('QR Code content: ' + data);
    }
}

// Gallery button functionality
document.getElementById('gallery-btn').addEventListener('click', function() {
    // Create a file input for gallery access
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "dontInvert",
                    });
                    
                    if (code) {
                        handleQRCode(code.data);
                    } else {
                        alert('No QR code found in the selected image.');
                    }
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    };
    input.click();
});

// Stop camera when leaving page
window.addEventListener('beforeunload', function() {
    if (video.srcObject) {
        const tracks = video.srcObject.getTracks();
        tracks.forEach(track => track.stop());
    }
});
</script>

</body></html>